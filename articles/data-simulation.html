<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data Simulation â€¢ JointODE</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Simulation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">JointODE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/data-simulation.html">Data Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/technical-details.html">Technical Details</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/signorinoy/JointODE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Data Simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/signorinoy/JointODE/blob/main/vignettes/data-simulation.Rmd" class="external-link"><code>vignettes/data-simulation.Rmd</code></a></small>
      <div class="d-none name"><code>data-simulation.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates how to simulate data from a joint ODE
model that combines longitudinal biomarker trajectories with survival
outcomes. The framework generates realistic clinical data where
biomarker dynamics influence event times through a shared random effect
structure.</p>
<div class="section level2">
<h2 id="review-of-model-setup">Review of Model Setup<a class="anchor" aria-label="anchor" href="#review-of-model-setup"></a>
</h2>
<div class="section level3">
<h3 id="longitudinal-model">Longitudinal Model<a class="anchor" aria-label="anchor" href="#longitudinal-model"></a>
</h3>
<p>The biomarker evolution follows a second-order ODE system:</p>
<p><span class="math display">\ddot{m}_i(t) =
g(\boldsymbol{\beta}^{\top}\mathbf{Z}_i(t))</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">m_i(t)</span>: Latent biomarker trajectory
for subject <span class="math inline">i</span>
</li>
<li>
<span class="math inline">\mathbf{Z}_i(t) = (m_i(t), \dot{m}_i(t),
\mathbf{X}_i(t)^{\top}, t)^{\top}</span>: Augmented state vector with
position, velocity, covariates, and time</li>
</ul>
<p>Observed measurements:</p>
<p><span class="math display">V_{ij} = m_i(T_{ij}) + b_i +
\varepsilon_{ij}</span></p>
<p>with <span class="math inline">b_i \sim N(0, \sigma_b^2)</span>
(random intercept) and <span class="math inline">\varepsilon_{ij} \sim
N(0, \sigma_e^2)</span> (measurement error).</p>
</div>
<div class="section level3">
<h3 id="survival-model">Survival Model<a class="anchor" aria-label="anchor" href="#survival-model"></a>
</h3>
<p>The hazard function incorporates trajectory dynamics:</p>
<p><span class="math display">\lambda_i(t|b_i) = \lambda_0(t)
\exp[\boldsymbol{\alpha}^{\top}\mathbf{m}_i(t) +
\mathbf{W}_i^{\top}\boldsymbol{\phi} + b_i]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\lambda_0(t)</span> baseline hazard
function</li>
<li>
<span class="math inline">\mathbf{m}_i(t) = (m_i(t), \dot{m}_i(t),
\ddot{m}_i(t))^{\top}</span>: Trajectory features (value, velocity,
acceleration)</li>
<li>
<span class="math inline">\mathbf{W}_i</span>: Baseline
covariates</li>
<li>
<span class="math inline">b_i</span>: Subject-specific random
intercept</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="parameter-specification">Parameter Specification<a class="anchor" aria-label="anchor" href="#parameter-specification"></a>
</h2>
<div class="section level3">
<h3 id="key-parameters">Key Parameters<a class="anchor" aria-label="anchor" href="#key-parameters"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Component</th>
<th>Parameter</th>
<th>Value</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>ODE Dynamics</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\beta_1</span></td>
<td>-0.3</td>
<td>Negative feedback (homeostasis)</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\beta_2</span></td>
<td>-0.5</td>
<td>Damping coefficient</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\beta_3</span></td>
<td>0.2</td>
<td>Treatment effect</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\beta_4</span></td>
<td>0.1</td>
<td>Seasonal effect</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\beta_5</span></td>
<td>0.05</td>
<td>Time trend</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">g(u)</span></td>
<td><span class="math inline">0.5\tanh(u/3)</span></td>
<td>Bounded nonlinear link function</td>
</tr>
<tr class="even">
<td><strong>Random Effects</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\sigma_b</span></td>
<td>0.5</td>
<td>Between-subject SD</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\sigma_e</span></td>
<td>0.1</td>
<td>Measurement error SD</td>
</tr>
<tr class="odd">
<td><strong>Survival</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\kappa</span></td>
<td>1.5</td>
<td>Weibull shape</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\theta</span></td>
<td>8</td>
<td>Weibull scale</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\alpha</span></td>
<td>(0.3, 0.1, -0.05)</td>
<td>Association parameters</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\phi</span></td>
<td>(0.2, -0.15)</td>
<td>Covariate effects</td>
</tr>
<tr class="even">
<td><strong>Covariates</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">X_1(t)</span></td>
<td><span class="math inline">e^{-t/5}</span></td>
<td>Treatment decay</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">X_2(t)</span></td>
<td><span class="math inline">0.2\sin(2\pi t)</span></td>
<td>Seasonal effect</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h2>
<div class="section level3">
<h3 id="dependencies-and-setup">Dependencies and Setup<a class="anchor" aria-label="anchor" href="#dependencies-and-setup"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span> <span class="co"># ODE numerical integration</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">simsurv</span><span class="op">)</span> <span class="co"># Flexible survival simulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># Visualization</span></span>
<span></span>
<span><span class="co"># Set random seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parameter-configuration">Parameter Configuration<a class="anchor" aria-label="anchor" href="#parameter-configuration"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Configure simulation parameters</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param n Sample size</span></span>
<span><span class="co">#' @param sigma_b Random effect standard deviation</span></span>
<span><span class="co">#' @param sigma_e Measurement error standard deviation</span></span>
<span><span class="co">#' @param alpha Association parameters (3-vector)</span></span>
<span><span class="co">#' @param beta Index weights (5-vector, normalized internally)</span></span>
<span><span class="co">#' @param phi Baseline covariate effects (2-vector)</span></span>
<span><span class="co">#' @return List of simulation parameters</span></span>
<span><span class="va">setup_simulation_params</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">n</span> <span class="op">=</span> <span class="fl">200</span>,</span>
<span>    <span class="va">sigma_b</span> <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    <span class="va">sigma_e</span> <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    <span class="va">alpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="op">-</span><span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    <span class="va">beta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    <span class="va">phi</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.15</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Normalize beta for identifiability</span></span>
<span>  <span class="va">beta_norm</span> <span class="op">&lt;-</span> <span class="va">beta</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">beta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="va">n</span>,</span>
<span>    sigma_b <span class="op">=</span> <span class="va">sigma_b</span>,</span>
<span>    sigma_e <span class="op">=</span> <span class="va">sigma_e</span>,</span>
<span>    alpha <span class="op">=</span> <span class="va">alpha</span>,</span>
<span>    beta <span class="op">=</span> <span class="va">beta_norm</span>,</span>
<span>    phi <span class="op">=</span> <span class="va">phi</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="core-model-functions">Core Model Functions<a class="anchor" aria-label="anchor" href="#core-model-functions"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Nonlinear link function</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param u Single index value</span></span>
<span><span class="co">#' @return Transformed value in [-0.5, 0.5]</span></span>
<span><span class="va">g_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html" class="external-link">tanh</a></span><span class="op">(</span><span class="va">u</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Weibull baseline hazard</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param t Time point</span></span>
<span><span class="co">#' @param shape Shape parameter (&gt;1 for increasing hazard)</span></span>
<span><span class="co">#' @param scale Scale parameter</span></span>
<span><span class="co">#' @return Hazard value at time t</span></span>
<span><span class="va">baseline_hazard</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">shape</span> <span class="op">=</span> <span class="fl">1.5</span>, <span class="va">scale</span> <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="va">shape</span> <span class="op">/</span> <span class="va">scale</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">t</span> <span class="op">/</span> <span class="va">scale</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">shape</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ode-system-definition">ODE System Definition<a class="anchor" aria-label="anchor" href="#ode-system-definition"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' ODE system for biomarker dynamics</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param t Current time</span></span>
<span><span class="co">#' @param state State vector [m, m_dot]</span></span>
<span><span class="co">#' @param params List containing beta, X_func, g_func</span></span>
<span><span class="co">#' @return List of derivatives</span></span>
<span><span class="va">ode_system</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">state</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">state</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># Position</span></span>
<span>  <span class="va">m_dot</span> <span class="op">&lt;-</span> <span class="va">state</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="co"># Velocity</span></span>
<span></span>
<span>  <span class="co"># Time-varying covariates</span></span>
<span>  <span class="va">x_t</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">x_func</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">params</span><span class="op">$</span><span class="fu">x_func</span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Augmented state vector</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">m_dot</span>, <span class="va">x_t</span>, <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Single index model</span></span>
<span>  <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">beta</span> <span class="op">*</span> <span class="va">z</span><span class="op">)</span></span>
<span>  <span class="va">m_ddot</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="fu">g_func</span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">m_dot</span>, <span class="va">m_ddot</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="trajectory-generation">Trajectory Generation<a class="anchor" aria-label="anchor" href="#trajectory-generation"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Generate individual trajectory</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param i Subject index</span></span>
<span><span class="co">#' @param params Simulation parameters</span></span>
<span><span class="co">#' @param tmax Maximum follow-up time</span></span>
<span><span class="co">#' @return List with trajectory functions and data</span></span>
<span><span class="va">generate_trajectory</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">params</span>, <span class="va">tmax</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Random effect</span></span>
<span>  <span class="va">b_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">params</span><span class="op">$</span><span class="va">sigma_b</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Baseline covariates</span></span>
<span>  <span class="va">w_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># Continuous (e.g., age)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co"># Binary (e.g., treatment)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Time-varying covariate functions</span></span>
<span>  <span class="va">x_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">t</span> <span class="op">/</span> <span class="fl">5</span><span class="op">)</span>, <span class="co"># Treatment decay</span></span>
<span>      <span class="fl">0.2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span> <span class="co"># Seasonal effect</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Initial conditions</span></span>
<span>  <span class="va">m_0</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">m_dot_0</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span>  <span class="co"># ODE parameters</span></span>
<span>  <span class="va">ode_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    beta <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">beta</span>,</span>
<span>    x_func <span class="op">=</span> <span class="va">x_func</span>,</span>
<span>    g_func <span class="op">=</span> <span class="va">g_function</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Numerical integration</span></span>
<span>  <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">tmax</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span>  <span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">m_0</span>, m_dot <span class="op">=</span> <span class="va">m_dot_0</span><span class="op">)</span>,</span>
<span>    times <span class="op">=</span> <span class="va">times</span>,</span>
<span>    func <span class="op">=</span> <span class="va">ode_system</span>,</span>
<span>    parms <span class="op">=</span> <span class="va">ode_params</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"lsoda"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Interpolation functions</span></span>
<span>  <span class="va">m_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span><span class="va">sol</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">sol</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, rule <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">m_dot_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span><span class="va">sol</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">sol</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, rule <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Acceleration computation</span></span>
<span>  <span class="va">x_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sol</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">x_func</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">z_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sol</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">sol</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, <span class="va">x_vals</span>, <span class="va">sol</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">u_vals</span> <span class="op">&lt;-</span> <span class="va">z_mat</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">params</span><span class="op">$</span><span class="va">beta</span></span>
<span>  <span class="va">m_ddot_vals</span> <span class="op">&lt;-</span> <span class="fu">g_function</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">u_vals</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">m_ddot_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span><span class="va">sol</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">m_ddot_vals</span>, rule <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="va">i</span>,</span>
<span>    b_i <span class="op">=</span> <span class="va">b_i</span>,</span>
<span>    w_i <span class="op">=</span> <span class="va">w_i</span>,</span>
<span>    x_func <span class="op">=</span> <span class="va">x_func</span>,</span>
<span>    m_func <span class="op">=</span> <span class="va">m_func</span>,</span>
<span>    m_dot_func <span class="op">=</span> <span class="va">m_dot_func</span>,</span>
<span>    m_ddot_func <span class="op">=</span> <span class="va">m_ddot_func</span>,</span>
<span>    trajectory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="survival-time-generation">Survival Time Generation<a class="anchor" aria-label="anchor" href="#survival-time-generation"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Generate survival times using simsurv</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param trajectories List of trajectory objects</span></span>
<span><span class="co">#' @param params Simulation parameters</span></span>
<span><span class="co">#' @return Data frame with survival times and censoring indicators</span></span>
<span><span class="va">generate_survival_times</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trajectories</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Covariate data</span></span>
<span>  <span class="va">covdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">trajectories</span><span class="op">)</span>,</span>
<span>    b_i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">trajectories</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">b_i</span><span class="op">)</span>,</span>
<span>    w1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">trajectories</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">w_i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    w2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">trajectories</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">w_i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Time-dependent hazard</span></span>
<span>  <span class="va">hazard_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">x</span>, <span class="va">betas</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"id"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">traj</span> <span class="op">&lt;-</span> <span class="va">trajectories</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>    <span class="co"># Trajectory evaluation</span></span>
<span>    <span class="va">m_t</span> <span class="op">&lt;-</span> <span class="va">traj</span><span class="op">$</span><span class="fu">m_func</span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>    <span class="va">m_dot_t</span> <span class="op">&lt;-</span> <span class="va">traj</span><span class="op">$</span><span class="fu">m_dot_func</span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>    <span class="va">m_ddot_t</span> <span class="op">&lt;-</span> <span class="va">traj</span><span class="op">$</span><span class="fu">m_ddot_func</span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Hazard computation</span></span>
<span>    <span class="va">h0</span> <span class="op">&lt;-</span> <span class="fu">baseline_hazard</span><span class="op">(</span><span class="va">t</span>, shape <span class="op">=</span> <span class="fl">1.5</span>, scale <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">log_hazard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">h0</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">m_t</span> <span class="op">+</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">alpha</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">m_dot_t</span> <span class="op">+</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">alpha</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">m_ddot_t</span> <span class="op">+</span></span>
<span>      <span class="va">x</span><span class="op">[</span><span class="st">"b_i"</span><span class="op">]</span> <span class="op">+</span></span>
<span>      <span class="va">betas</span><span class="op">[</span><span class="st">"w1"</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="st">"w1"</span><span class="op">]</span> <span class="op">+</span></span>
<span>      <span class="va">betas</span><span class="op">[</span><span class="st">"w2"</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="st">"w2"</span><span class="op">]</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_hazard</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Generate event times</span></span>
<span>  <span class="va">surv_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/simsurv/man/simsurv.html" class="external-link">simsurv</a></span><span class="op">(</span></span>
<span>    hazard <span class="op">=</span> <span class="va">hazard_func</span>,</span>
<span>    x <span class="op">=</span> <span class="va">covdat</span>,</span>
<span>    betas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>w1 <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">phi</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, w2 <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">phi</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    maxt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-8</span>, <span class="fl">15</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Administrative censoring</span></span>
<span>  <span class="va">cens_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">covdat</span><span class="op">)</span>,</span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">surv_times</span><span class="op">$</span><span class="va">eventtime</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">surv_times</span><span class="op">$</span><span class="va">eventtime</span>, <span class="fl">0.95</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">surv_times</span><span class="op">$</span><span class="va">obstime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">surv_times</span><span class="op">$</span><span class="va">eventtime</span>, <span class="va">cens_times</span><span class="op">)</span></span>
<span>  <span class="va">surv_times</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">surv_times</span><span class="op">$</span><span class="va">eventtime</span> <span class="op">&lt;=</span> <span class="va">cens_times</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">surv_times</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="longitudinal-measurement-process">Longitudinal Measurement Process<a class="anchor" aria-label="anchor" href="#longitudinal-measurement-process"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Generate longitudinal measurements</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param trajectories List of trajectory objects</span></span>
<span><span class="co">#' @param surv_times Survival data frame</span></span>
<span><span class="co">#' @param params Simulation parameters</span></span>
<span><span class="co">#' @return Data frame with longitudinal observations</span></span>
<span><span class="va">generate_longitudinal_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trajectories</span>, <span class="va">surv_times</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">long_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">trajectories</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">traj</span> <span class="op">&lt;-</span> <span class="va">trajectories</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">t_i</span> <span class="op">&lt;-</span> <span class="va">surv_times</span><span class="op">$</span><span class="va">obstime</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span>    <span class="co"># Measurement schedule</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">t_i</span> <span class="op">&lt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">visit_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">t_i</span>, by <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">quarterly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">t_i</span> <span class="op">&gt;</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">semiannual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="va">t_i</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>        <span class="va">visit_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">quarterly</span>, <span class="va">semiannual</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">visit_times</span> <span class="op">&lt;-</span> <span class="va">quarterly</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Introduce random missingness</span></span>
<span>    <span class="va">visit_times</span> <span class="op">&lt;-</span> <span class="va">visit_times</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">visit_times</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.1</span><span class="op">]</span></span>
<span></span>
<span>    <span class="co"># Ensure baseline measurement</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">visit_times</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">visit_times</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span>    <span class="co"># Measurements with error and covariates</span></span>
<span>    <span class="va">measurements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">visit_times</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">x1_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">visit_times</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">x2_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">visit_times</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">visit_times</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">m_true</span> <span class="op">&lt;-</span> <span class="va">traj</span><span class="op">$</span><span class="fu">m_func</span><span class="op">(</span><span class="va">visit_times</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">measurements</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m_true</span> <span class="op">+</span> <span class="va">traj</span><span class="op">$</span><span class="va">b_i</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">params</span><span class="op">$</span><span class="va">sigma_e</span><span class="op">)</span></span>
<span></span>
<span>      <span class="co"># Store covariate values at observation times</span></span>
<span>      <span class="va">x_vals</span> <span class="op">&lt;-</span> <span class="va">traj</span><span class="op">$</span><span class="fu">x_func</span><span class="op">(</span><span class="va">visit_times</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">x1_obs</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x_vals</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>      <span class="va">x2_obs</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x_vals</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">long_data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="va">traj</span><span class="op">$</span><span class="va">id</span>,</span>
<span>      time <span class="op">=</span> <span class="va">visit_times</span>,</span>
<span>      value <span class="op">=</span> <span class="va">measurements</span>,</span>
<span>      x1 <span class="op">=</span> <span class="va">x1_obs</span>, <span class="co"># Treatment effect</span></span>
<span>      x2 <span class="op">=</span> <span class="va">x2_obs</span>, <span class="co"># Seasonal effect</span></span>
<span>      b_true <span class="op">=</span> <span class="va">traj</span><span class="op">$</span><span class="va">b_i</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">long_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="main-simulation-interface">Main Simulation Interface<a class="anchor" aria-label="anchor" href="#main-simulation-interface"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Simulate joint ODE model data</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param n Sample size</span></span>
<span><span class="co">#' @param seed Random seed</span></span>
<span><span class="co">#' @return List containing longitudinal and survival datasets</span></span>
<span><span class="va">simulate_joint_ode_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">200</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">123</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Initialize</span></span>
<span>  <span class="va">params</span> <span class="op">&lt;-</span> <span class="fu">setup_simulation_params</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Generate trajectories</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Step 1/3: Generating ODE trajectories..."</span><span class="op">)</span></span>
<span>  <span class="va">trajectories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="va">generate_trajectory</span>, params <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Generate survival</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Step 2/3: Generating survival times..."</span><span class="op">)</span></span>
<span>  <span class="va">surv_data</span> <span class="op">&lt;-</span> <span class="fu">generate_survival_times</span><span class="op">(</span><span class="va">trajectories</span>, <span class="va">params</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Report censoring</span></span>
<span>  <span class="va">actual_censoring</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">surv_data</span><span class="op">$</span><span class="va">status</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Achieved censoring: %.1f%%"</span>, <span class="va">actual_censoring</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Generate longitudinal</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Step 3/3: Generating longitudinal data..."</span><span class="op">)</span></span>
<span>  <span class="va">long_data</span> <span class="op">&lt;-</span> <span class="fu">generate_longitudinal_data</span><span class="op">(</span><span class="va">trajectories</span>, <span class="va">surv_data</span>, <span class="va">params</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Merge covariates</span></span>
<span>  <span class="va">baseline_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    w1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">trajectories</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">w_i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    w2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">trajectories</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">w_i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    b_true <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">trajectories</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">b_i</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">surv_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">surv_data</span>, <span class="va">baseline_data</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Return datasets</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      long_data <span class="op">=</span> <span class="va">long_data</span>,</span>
<span>      surv_data <span class="op">=</span> <span class="va">surv_data</span>,</span>
<span>      params <span class="op">=</span> <span class="va">params</span>,</span>
<span>      trajectories <span class="op">=</span> <span class="va">trajectories</span></span>
<span>    <span class="op">)</span>,</span>
<span>    class <span class="op">=</span> <span class="st">"joint_ode_data"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="usage-example">Usage Example<a class="anchor" aria-label="anchor" href="#usage-example"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate synthetic dataset</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu">simulate_joint_ode_data</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">200</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span><span class="co">#&gt; Step 1/3: Generating ODE trajectories...</span></span>
<span><span class="co">#&gt; Step 2/3: Generating survival times...</span></span>
<span><span class="co">#&gt;   Achieved censoring: 35.0%</span></span>
<span><span class="co">#&gt; Step 3/3: Generating longitudinal data...</span></span>
<span></span>
<span><span class="co"># Extract components</span></span>
<span><span class="va">long_data</span> <span class="op">&lt;-</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">long_data</span></span>
<span><span class="va">surv_data</span> <span class="op">&lt;-</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">surv_data</span></span>
<span></span>
<span><span class="co"># Dataset overview</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n========== Dataset Summary ==========\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ========== Dataset Summary ==========</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Total subjects: %d\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">surv_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total subjects: 200</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Total observations: %d\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">long_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total observations: 2783</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"Avg obs/subject: %.1f (range: %d-%d)\n"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">long_data</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">surv_data</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">long_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">long_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Avg obs/subject: 13.9 (range: 2-23)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n---------- Event Statistics ----------\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---------- Event Statistics ----------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"Events: %d (%.1f%%)\n"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">surv_data</span><span class="op">$</span><span class="va">status</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">surv_data</span><span class="op">$</span><span class="va">status</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Events: 130 (65.0%)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"Censored: %d (%.1f%%)\n"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">surv_data</span><span class="op">$</span><span class="va">status</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">surv_data</span><span class="op">$</span><span class="va">status</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Censored: 70 (35.0%)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n---------- Follow-up Time ----------\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---------- Follow-up Time ----------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Median: %.2f years\n"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">surv_data</span><span class="op">$</span><span class="va">obstime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Median: 6.07 years</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"Range: %.2f - %.2f years\n"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">surv_data</span><span class="op">$</span><span class="va">obstime</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">surv_data</span><span class="op">$</span><span class="va">obstime</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Range: 0.40 - 9.75 years</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n---------- Data Structure ----------\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---------- Data Structure ----------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Longitudinal columns:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">long_data</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Longitudinal columns: id, time, value, x1, x2, b_true</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Survival columns:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">surv_data</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Survival columns: id, eventtime, status, obstime, w1, w2, b_true</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select subjects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">sample_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">long_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">long_data</span><span class="op">[</span><span class="va">long_data</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_ids</span>, <span class="op">]</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">plot_data</span>,</span>
<span>  <span class="va">surv_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"obstime"</span>, <span class="st">"status"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"obstime"</span>, <span class="st">"status"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">obstime</span>, linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">status</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.4</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"dashed"</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Censored"</span>, <span class="st">"Event"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Outcome"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Subject"</span>, <span class="va">id</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Time (years)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Biomarker Value"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Simulated Longitudinal Trajectories"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Vertical lines: event (solid) or censoring (dashed)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"gray95"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="data-simulation_files/figure-html/plot-trajectories-1.png" alt="Representative trajectories" width="768"><p class="caption">
Representative trajectories
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ziyang Gong.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
