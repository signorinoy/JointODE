% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils.R
\name{.process}
\alias{.process}
\title{Process Data for Joint Modeling}
\usage{
.process(
  longitudinal_formula,
  longitudinal_data,
  survival_formula,
  survival_data,
  id,
  time
)
}
\arguments{
\item{longitudinal_formula}{A formula object specifying the longitudinal
model. The response variable (left-hand side) represents the longitudinal
outcome, while the right-hand side specifies time-varying covariates.}

\item{longitudinal_data}{A data frame containing longitudinal measurements.
Should contain multiple rows per subject with measurements at
different time points.}

\item{survival_formula}{A formula object specifying the survival model.
Must use \code{Surv(time, status)} on the left-hand side.
The right-hand side specifies baseline hazard covariates.}

\item{survival_data}{A data frame containing survival/event data.
Must contain exactly one row per subject with event time and status.}

\item{id}{Character string specifying the name of the subject identifier
variable. This variable links records between \code{longitudinal_data} and
\code{survival_data}.}

\item{time}{Character string specifying the name of the measurement time
variable in the longitudinal data.}
}
\value{
A list of class \code{"JointODE.data"} where each element
represents one subject
and contains:
\describe{
\item{id}{Subject identifier}
\item{time}{Time to event or censoring}
\item{status}{Event indicator (0 = censored, 1 = event)}
\item{covariates}{Data frame of baseline covariates from survival model}
\item{longitudinal}{List containing:
\describe{
\item{times}{Vector of measurement times}
\item{measurements}{Vector of longitudinal outcomes}
\item{covariates}{Data frame of time-varying covariates}
\item{n_obs}{Number of longitudinal observations}
}
}
}
The returned list also has the following attributes:
\describe{
\item{n_subjects}{Total number of subjects}
\item{n_observations}{Total number of longitudinal observations}
\item{event_rate}{Proportion of subjects experiencing the event}
}
}
\description{
Transforms longitudinal and survival data into a subject-oriented structure
for efficient likelihood computation. Each list element contains one
subject's complete information including measurements, covariates, and
event data.
}
\details{
This function performs the following operations:
\enumerate{
\item Extracts model components from formulas using \code{model.frame}
and \code{model.matrix}
\item Reorganizes data into a subject-centric structure
\item Ensures temporal ordering of longitudinal measurements
\item Handles subjects with missing longitudinal data gracefully
\item Computes summary statistics for the cohort
}

The function is optimized for performance with pre-allocation and efficient
indexing strategies, making it suitable for large datasets.
}
\note{
This function assumes that \code{.validate()} has been called first to ensure
data integrity. Invalid data may cause unexpected behavior or errors.
}
\examples{
\dontrun{
# Prepare example data
longitudinal_data <- data.frame(
  id = rep(1:100, each = 5),
  time = rep(0:4, 100),
  v = rnorm(500) + rep(rnorm(100), each = 5),
  x1 = rnorm(500),
  x2 = rep(rbinom(100, 1, 0.5), each = 5)
)

survival_data <- data.frame(
  id = 1:100,
  time = rexp(100, 0.1),
  status = rbinom(100, 1, 0.7),
  w1 = rnorm(100),
  w2 = rbinom(100, 1, 0.4)
)

data_process <- .process(
  longitudinal_formula = v ~ x1 + x2,
  longitudinal_data = longitudinal_data,
  survival_formula = Surv(time, status) ~ w1 + w2,
  survival_data = survival_data,
  id = "id",
  time = "time"
)

# Examine the structure
str(data_process[[1]]) # First subject's data
attributes(data_process) # Summary statistics
}

}
\seealso{
\code{\link{.validate}} for data validation,
\code{\link{JointODE}} for model fitting
}
\concept{utilities}
