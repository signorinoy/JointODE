% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate.R
\name{simulate}
\alias{simulate}
\title{Simulate Joint ODE Model Data}
\usage{
simulate(
  n = 50,
  alpha = c(0.3, 0.1, -0.05),
  beta = c(-0.3, -0.5, 0.2, 0.1, 0.05),
  phi = c(0.2, -0.15),
  weibull_shape = 1.5,
  weibull_scale = 8,
  sigma_b = 0.5,
  sigma_e = 0.1,
  seed = 42,
  verbose = TRUE
)
}
\arguments{
\item{n}{Integer. Number of subjects to simulate (default: 50).}

\item{alpha}{Numeric vector of length 3. Association parameters linking
trajectory features to survival hazard: \code{[value, velocity,
  acceleration]} (default: c(0.3, 0.1, -0.05)).}

\item{beta}{Numeric vector of length 5. ODE dynamics parameters controlling
trajectory evolution: \code{[position_feedback, damping, treatment_effect,
  seasonal_effect, time_trend]} (default: c(-0.3, -0.5, 0.2, 0.1, 0.05)).}

\item{phi}{Numeric vector of length 2. Baseline covariate effects on
survival hazard: \code{[continuous_covariate, binary_covariate]}
(default: c(0.2, -0.15)).}

\item{weibull_shape}{Numeric. Shape parameter (\eqn{\kappa}) for Weibull
baseline hazard. Values > 1 indicate increasing hazard, < 1 decreasing
(default: 1.5).}

\item{weibull_scale}{Numeric. Scale parameter (\eqn{\theta}) for Weibull
baseline hazard controlling the time scale (default: 8).}

\item{sigma_b}{Numeric. Standard deviation of subject-specific random
intercepts representing between-subject heterogeneity (default: 0.5).}

\item{sigma_e}{Numeric. Standard deviation of measurement error for
longitudinal observations (default: 0.1).}

\item{seed}{Integer. Random seed for reproducibility (default: 42).}

\item{verbose}{Logical. Print progress messages during simulation
(default: TRUE).}
}
\value{
A list of containing:
\describe{
\item{data.long}{Data frame with longitudinal measurements:
\itemize{
\item \code{id}: Subject identifier
\item \code{time}: Measurement time
\item \code{v}: Observed biomarker value (latent + random effect
+ error)
\item \code{x1}: Time-varying covariate 1 (treatment decay:
\eqn{e^{-t/5}})
\item \code{x2}: Time-varying covariate 2 (seasonal:
\eqn{0.2\sin(2\pi t)})
}}
\item{data.surv}{Data frame with survival outcomes:
\itemize{
\item \code{id}: Subject identifier
\item \code{time}: Observed event/censoring time
\item \code{status}: Event indicator (1 = event, 0 = censored)
\item \code{w1}: Baseline continuous covariate ~ N(0,1)
\item \code{w2}: Baseline binary covariate ~ Bernoulli(0.5)
}}
}
}
\description{
Generates synthetic data from a joint ordinary differential equation (ODE)
model that couples longitudinal biomarker trajectories with time-to-event
outcomes. This framework produces realistic clinical trial or observational
study data where biomarker dynamics influence event hazards through shared
random effects and trajectory features.
}
\details{
\strong{Model Framework}

The simulation implements a joint model with two coupled components:

\strong{1. Longitudinal Model}

Biomarker evolution follows a second-order nonlinear ODE:
\deqn{\ddot{m}_i(t) = g(\boldsymbol{\beta}^T \mathbf{Z}_i(t))}

where:
\itemize{
\item \eqn{m_i(t)} is the latent biomarker trajectory for subject \eqn{i}
\item \eqn{\mathbf{Z}_i(t) = [m_i(t), \dot{m}_i(t), X_1(t), X_2(t), t]^T}
is the augmented state vector
\item \eqn{g(u) = 0.5 \tanh(u/3)} is a bounded nonlinear link function
ensuring stability
\item \eqn{\boldsymbol{\beta}} controls dynamics (feedback, damping,
covariate effects)
}

Observed measurements incorporate random effects and error:
\deqn{V_{ij} = m_i(T_{ij}) + b_i + \varepsilon_{ij}}

with \eqn{b_i \sim N(0, \sigma_b^2)} and
\eqn{\varepsilon_{ij} \sim N(0, \sigma_e^2)}.

\strong{2. Survival Model}

The hazard function links trajectory dynamics to event risk:
\deqn{\lambda_i(t|b_i) = \lambda_0(t) \exp[\boldsymbol{\alpha}^T
  \mathbf{m}_i(t) + \mathbf{W}_i^T \boldsymbol{\phi} + b_i]}

where:
\itemize{
\item \eqn{\lambda_0(t) = (\kappa/\theta)(t/\theta)^{\kappa-1}} is the
Weibull baseline hazard
\item \eqn{\mathbf{m}_i(t) = [m_i(t), \dot{m}_i(t), \ddot{m}_i(t)]^T}
captures trajectory features
\item \eqn{\mathbf{W}_i} are baseline covariates
\item \eqn{b_i} is the shared random effect linking models
}

\strong{Simulation Process}

\enumerate{
\item \strong{ODE Integration}: Solve the second-order ODE system for each
subject using adaptive LSODA algorithm
\item \strong{Survival Generation}: Sample event times from the conditional
hazard using the \code{simsurv} package
\item \strong{Censoring}: Apply administrative censoring uniformly between
50th and 95th percentiles of event times
\item \strong{Longitudinal Sampling}: Generate visit schedules (quarterly
for years 0-2, semi-annual thereafter) with 10\% random missingness
}

\strong{Parameter Interpretation}

\itemize{
\item \strong{ODE parameters (\code{beta})}:
\itemize{
\item \code{beta[1]}: Negative feedback (homeostasis), typically < 0
\item \code{beta[2]}: Damping coefficient (stability), typically < 0
\item \code{beta[3-5]}: Covariate and time effects
}
\item \strong{Association (\code{alpha})}:
\itemize{
\item \code{alpha[1]}: Current value association (typically > 0 for
risk biomarkers)
\item \code{alpha[2]}: Rate of change association
\item \code{alpha[3]}: Acceleration association (often < 0 for
stability)
}
}
}
\note{
\itemize{
\item The \code{beta} parameters are normalized internally to ensure
model identifiability
\item Visit schedules automatically adjust based on follow-up duration
\item Setting \code{verbose = FALSE} suppresses all progress messages
}
}
\examples{
# Basic usage with default parameters
sim <- simulate()
str(sim)

# Check data characteristics
cat("Event rate:", mean(sim$data.surv$status), "\n")
cat(
  "Observations per subject:",
  nrow(sim$data.long) / nrow(sim$data.surv), "\n"
)

# Visualize trajectories with survival information
library(ggplot2)
library(dplyr)

# Select subjects with different outcomes
plot_data <- sim$data.long \%>\%
  left_join(sim$data.surv[, c("id", "time", "status")],
    by = "id", suffix = c("", "_event")
  ) \%>\%
  filter(id \%in\% sample(unique(id), 9))

ggplot(plot_data, aes(x = time, y = v)) +
  geom_line(aes(color = factor(status)), alpha = 0.7) +
  geom_point(aes(color = factor(status)), size = 1) +
  geom_vline(aes(xintercept = time_event),
    linetype = "dashed", alpha = 0.5
  ) +
  facet_wrap(~id, scales = "free_y", ncol = 3) +
  scale_color_manual(
    values = c("0" = "blue", "1" = "red"), labels = c("Censored", "Event")
  ) +
  theme_minimal() +
  labs(
    x = "Time (years)", y = "Biomarker Value", color = "Outcome",
    title = "Simulated Longitudinal Trajectories"
  )

}
\seealso{
\code{\link[simsurv]{simsurv}} for the underlying survival simulation
\code{\link[deSolve]{ode}} for ODE integration details
}
\concept{utilities}
